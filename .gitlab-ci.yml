stages:
  - testing
  - publishing

.testing_template: &python_matrix
  stage: testing
  script:
    - make install-development
    - make coverage

coverage:cpython36:
  <<: *python_matrix
  image: python:3.6-buster

coverage:cpython37:
  <<: *python_matrix
  image: python:3.7-buster

coverage:cpython38:
  <<: *python_matrix
  image: python:3.8-buster
  artifacts:
    paths:
      - htmlcov
    expire_in: 3 days

coverage:pypy36:
  <<: *python_matrix
  image: pypy:3.6-buster

pages:
  image: debian:buster
  stage: publishing
  dependencies:
    - coverage:py3.8
  script:
    - rm --force --recursive public
    - cp --recursive htmlcov public
  artifacts:
    paths:
      - public
    expire_in: 1 week
  only:
    - master
    - schedules
    - tags
